{% extends 'time_tracking/base.html' %}

{% block title %}Buchung wählen{% endblock %}

{% block body_class %}booking-screen{% endblock %}

{% block content %}
<div class="container">
    <h1>Hallo {{ employee_name }}!</h1>
    <p class="instruction">Was möchten Sie buchen?</p>
    
    <div class="button-grid">
        <button class="booking-btn" data-type="kommen">Kommen</button>
        <button class="booking-btn" data-type="gehen">Gehen</button>
        <button class="booking-btn" data-type="dienstgang_start">Dienstgang Start</button>
        <button class="booking-btn" data-type="dienstgang_ende">Dienstgang Ende</button>
        <button class="booking-btn" data-type="pause_start">Pause Start</button>
        <button class="booking-btn" data-type="pause_ende">Pause Ende</button>
    </div>
    
    <p class="cancel"><a href="{% url 'time_tracking:scan' %}">Abbrechen</a></p>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Timeout: Nach 15 Sekunden zurück zur Scan-Seite
let timeout = setTimeout(function() {
    window.location.href = "{% url 'time_tracking:scan' %}";
}, 15000);

// Button-Klicks
document.querySelectorAll('.booking-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        clearTimeout(timeout);
        
        const bookingType = this.dataset.type;
        const formData = new FormData();
        formData.append('booking_type', bookingType);
        
        fetch('/booking/', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('✓ Buchung erfolgreich!');
                setTimeout(() => {
                    window.location.href = "{% url 'time_tracking:scan' %}";
                }, 2000);
            } else {
                alert('✗ Fehler: ' + data.error);
            }
        });
    });
});
</script>
{% endblock %}
