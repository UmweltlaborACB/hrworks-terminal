{% extends 'time_tracking/base.html' %}

{% block content %}
<div class="container">
    <h1>üîê Zeiterfassung</h1>
    <p class="instruction">Bitte Chip auflegen</p>
    <div class="loading-spinner"></div>
    <p style="opacity: 0.7; margin-top: 20px;">Warten auf RFID-Chip...</p>
</div>

<script>
let chipIdBuffer = '';
let lastKeyTime = Date.now();

document.addEventListener('keypress', function(e) {
    const currentTime = Date.now();
    
    // Wenn l√§nger als 100ms zwischen Tasten: Buffer zur√ºcksetzen
    if (currentTime - lastKeyTime > 100) {
        chipIdBuffer = '';
    }
    lastKeyTime = currentTime;
    
    // Enter = Chip-ID komplett
    if (e.key === 'Enter' && chipIdBuffer.length > 0) {
        const chipId = chipIdBuffer.trim();
        console.log('RFID erkannt:', chipId);
        
        // Zu Booking weiterleiten
        window.location.href = `/booking/?chip_id=${encodeURIComponent(chipId)}`;
        
        chipIdBuffer = '';
    } else if (e.key !== 'Enter') {
        // Zeichen zum Buffer hinzuf√ºgen
        chipIdBuffer += e.key;
    }
});

// Fokus sicherstellen (damit Tastatureingaben ankommen)
window.focus();
</script>
{% endblock %}
